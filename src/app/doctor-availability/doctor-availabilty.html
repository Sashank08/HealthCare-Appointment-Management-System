<div class="dashboard-container">
  
  <!-- Role-based Welcome Message -->
  <div class="welcome-section mb-4">
    <div class="alert" [class.alert-warning]="userRole === 'DOCTOR'" [class.alert-info]="userRole === 'PATIENT'" [class.alert-secondary]="!userRole">
      <h4 class="mb-2">
        <i class="fas fa-user-md me-2" *ngIf="userRole === 'DOCTOR'"></i>
        <i class="fas fa-user me-2" *ngIf="userRole === 'PATIENT'"></i>
        <i class="fas fa-users me-2" *ngIf="!userRole"></i>
        <span *ngIf="userRole === 'DOCTOR'">👨‍⚕️ Doctor Portal - Manage Your Availability</span>
        <span *ngIf="userRole === 'PATIENT'">👤 Patient Portal - View Doctor Schedules</span>
        <span *ngIf="!userRole">🏥 Doctor Availability System</span>
      </h4>
      <p class="mb-0">
        <span *ngIf="userRole === 'DOCTOR'">Create and manage your appointment slots for patients</span>
        <span *ngIf="userRole === 'PATIENT'">Search and view available appointment slots with doctors</span>
        <span *ngIf="!userRole">Please login to access personalized features</span>
      </p>
    </div>
  </div>
 
  <div class="search-section">
    <h2>
      <span *ngIf="userRole === 'DOCTOR'">📋 My Availability Schedule</span>
      <span *ngIf="userRole === 'PATIENT'">🔍 Find Available Doctors</span>
      <span *ngIf="!userRole">🔍 Search Doctor Availability</span>
    </h2>
    <div class="search-form">
      <div class="search-field">
        <label class="search-label" *ngIf="userRole === 'PATIENT'">👨⚕️ Doctor ID (Optional)</label>
        <label class="search-label" *ngIf="userRole === 'DOCTOR'">👨⚕️ Your Doctor ID</label>
        <label class="search-label" *ngIf="!userRole">👨⚕️ Doctor ID</label>
        <input type="number" [(ngModel)]="searchDoctorID" 
               [placeholder]="userRole === 'DOCTOR' ? 'Your Doctor ID (auto-filled)' : userRole === 'PATIENT' ? 'Leave empty to see all doctors' : 'Enter Doctor ID'" 
               min="1" class="search-input" 
               title="Enter a valid doctor ID">
      </div>
      <div class="search-field">
        <label class="search-label">📅 From Date</label>
        <input type="date" [(ngModel)]="startDate" class="search-input" title="Select start date">
      </div>
      <div class="search-field">
        <label class="search-label">📅 To Date</label>
        <input type="date" [(ngModel)]="endDate" class="search-input" title="Select end date">
      </div>
      <div class="search-field">
        <button (click)="searchAvailability()" class="btn-primary search-btn" [disabled]="isLoading">
          <span *ngIf="!isLoading">
            <span *ngIf="userRole === 'DOCTOR'">📅 View My Schedule</span>
            <span *ngIf="userRole === 'PATIENT'">🔍 Find Available Doctors</span>
            <span *ngIf="!userRole">🔍 Search</span>
          </span>
          <span *ngIf="isLoading" class="loading-spinner"></span>
          <span *ngIf="isLoading">Searching...</span>
        </button>
      </div>
    </div>
  </div>
 
  <div *ngIf="message" class="message" [ngClass]="'message-' + messageType">
    {{ message }}
  </div>
 
  <div *ngIf="availabilities && availabilities.length > 0" class="availability-section">
    <h2>
      <span *ngIf="userRole === 'DOCTOR'">📋 Your Availability Schedule</span>
      <span *ngIf="userRole === 'PATIENT'">👨⚕️ Available Doctors</span>
      <span *ngIf="!userRole">Available Schedules</span>
    </h2>
    
    <!-- Patient-specific info -->
    <div class="alert alert-success mb-4" *ngIf="userRole === 'PATIENT'">
      <i class="fas fa-calendar-check me-2"></i>
      <strong>Found {{availabilities.length}} available doctor(s)</strong> - Click "Book Appointment" to schedule your visit
    </div>
    
    <!-- Doctor-specific info -->
    <div class="alert alert-warning mb-4" *ngIf="userRole === 'DOCTOR'">
      <i class="fas fa-user-md me-2"></i>
      <strong>Your Schedule Overview:</strong> Manage your {{availabilities.length}} availability slot(s)
    </div>
    <div class="availability-grid">
      <div *ngFor="let availability of availabilities" class="availability-card">
        <div class="card-header">
          <h3>
            👨⚕️ Dr. {{ availability.doctorID }}
            <span class="badge bg-success ms-2" *ngIf="isCurrentDoctor(availability.doctorID)">Your Schedule</span>
          </h3>
          <div class="card-actions" *ngIf="canManageAvailability() && isCurrentDoctor(availability.doctorID)">
            <button (click)="openUpdateModal(availability)" class="btn-update">✏️ Edit</button>
            <button (click)="deleteAvailability(availability.doctorID, availability.date)" class="btn-delete">🗑️ Delete</button>
          </div>
          <div class="card-actions" *ngIf="userRole === 'PATIENT'">
            <button class="btn btn-success" (click)="bookAppointment(availability)">📅 Book Appointment</button>
          </div>
          <div class="card-actions" *ngIf="!userRole">
            <div class="text-muted small">
              <i class="fas fa-info-circle me-1"></i>Login to book appointments
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="date-info">
            <strong>Date:</strong> {{ availability.date }}
          </div>
          <div class="time-slots">
            <strong>🕰️ Available Time Slots:</strong>
            <div class="slots-container">
              <span *ngFor="let slot of availability.timeSlots; let i = index" class="time-slot-badge" [style.animation-delay.ms]="i * 100">
                ⏰ {{ slot }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
 


  <div class="add-section" *ngIf="canManageAvailability()">
    <div class="form-container">
      <h3>📅 Add New Availability</h3>
      <div class="alert alert-info mb-4">
        <i class="fas fa-info-circle me-2"></i>
        <strong>Doctor Portal:</strong> Create your availability slots for patient appointments
      </div>
      <form (ngSubmit)="onSubmit()" #addForm="ngForm">
        <div class="form-group">
          <label for="doctorID">👨⚕️ Doctor ID *</label>
          <input type="number" id="doctorID" name="doctorID" [(ngModel)]="doctorID" required min="1" 
                 class="form-input" 
                 [placeholder]="userRole === 'DOCTOR' ? 'Your Doctor ID (auto-filled)' : 'Enter Doctor ID (e.g., 101)'">
          <div class="field-hint">
            <span *ngIf="userRole === 'DOCTOR'">Your doctor ID is automatically filled</span>
            <span *ngIf="userRole !== 'DOCTOR'">Enter a valid doctor identification number</span>
          </div>
        </div>
        <div class="form-group">
          <label for="date">📅 Date *</label>
          <input type="date" id="date" name="date" [(ngModel)]="date" required class="form-input">
          <div class="field-hint">Select a future date for availability</div>
        </div>
        <div class="form-group">
          <label>🕰️ Select Time Slots * (Max 8 slots)</label>
          <div class="time-slots-grid">
            <button *ngFor="let slot of availableTimeSlots" type="button" class="time-slot-btn" [class.selected]="isSlotSelected(slot)" (click)="toggleTimeSlot(slot)">
              {{ slot }}
            </button>
          </div>
          <div *ngIf="selectedTimeSlots && selectedTimeSlots.length > 0" class="selected-slots">
            <strong>✅ Selected: </strong>{{ selectedTimeSlots.length }} slot(s)
          </div>
        </div>
        <button type="submit" class="btn-primary" [disabled]="isSubmitting || !doctorID || !date || !selectedTimeSlots || selectedTimeSlots.length === 0">
          <span *ngIf="!isSubmitting">➕ Add Availability</span>
          <span *ngIf="isSubmitting" class="loading-spinner"></span>
          <span *ngIf="isSubmitting">Adding...</span>
        </button>
      </form>
    </div>
  </div>
</div>
 
<div *ngIf="showUpdateModal" class="modal-overlay" (click)="closeUpdateModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>✏️ Update Availability</h3>
      <button class="close-btn" (click)="closeUpdateModal()">✕</button>
    </div>
    <form (ngSubmit)="onUpdateSubmit()" #updateForm="ngForm">
      <div class="form-group">
        <label for="updateDoctorID">👨⚕️ Doctor ID *</label>
        <input type="number" id="updateDoctorID" name="updateDoctorID" [(ngModel)]="updateDoctorID" required min="1" class="form-input" placeholder="Enter Doctor ID">
        <div class="field-hint">Enter a valid doctor identification number</div>
      </div>
      <div class="form-group">
        <label for="updateDate">📅 Date *</label>
        <input type="date" id="updateDate" name="updateDate" [(ngModel)]="updateDate" required class="form-input">
        <div class="field-hint">Select a future date for availability</div>
      </div>
      <div class="form-group">
        <label>🕰️ Select Time Slots * (Max 8 slots)</label>
        <div class="time-slots-grid">
          <button *ngFor="let slot of availableTimeSlots" type="button" class="time-slot-btn" [class.selected]="isUpdateSlotSelected(slot)" (click)="toggleUpdateTimeSlot(slot)">
            {{ slot }}
          </button>
        </div>
        <div *ngIf="updateSelectedTimeSlots && updateSelectedTimeSlots.length > 0" class="selected-slots">
          <strong>✅ Selected: </strong>{{ updateSelectedTimeSlots.length }} slot(s)
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="closeUpdateModal()">Cancel</button>
        <button type="submit" class="btn-primary" [disabled]="isSubmitting || !updateDoctorID || !updateDate || !updateSelectedTimeSlots || updateSelectedTimeSlots.length === 0">
          <span *ngIf="!isSubmitting">💾 Update Availability</span>
          <span *ngIf="isSubmitting" class="loading-spinner"></span>
          <span *ngIf="isSubmitting">Updating...</span>
        </button>
      </div>
    </form>
  </div>
</div>